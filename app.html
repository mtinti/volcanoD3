
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    
    <title>Zoomable Volcano Plot with Tooltips in D3 v4</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.css" >
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:400,700" >
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css" >
    <link rel="stylesheet" href="volcano.css">
</head>
<body>

    <div class="container">
        <div class="jumbotron">
            <h1>The TbPIG-A inteaction network</h1>
        </div> 
      

    
        <div class="row">
            <div class="col">
                <h2>Volcano Plot</h2>
                <div class="card">
                    <div id="chart1"></div>
                    <button id="resetBtn1">Reset</button>
                </div>
            </div>

            
            <div class="col">
                <h2>Intensity Plot</h2>
                <div class="card">
                    <div id="chart2"></div>   
                    <button id="resetBtn2">Reset</button>
                </div>  
            </div> 

            <div class="col">
                <h2>MA Plot</h2>
                <div class="card">
                    <div id="chart3"></div> 
                    <button id="resetBtn3">Reset</button>
                </div>
           </div>   
            
        </div>
        <br>
        <div class="row">


            <div class="col-8">
                <h2>Identified Proteins</h2>
                <div class="card">
                <table id='table1' class="display" > </table>
                </div>
            </div>             


         
        </div>


    </div>

    
 
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" ></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" ></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>  
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script> 
 
    <script src="volcano.js"></script>

<script>
    var file = "Dataset_min.csv";
    
    //table_tip = d3.tip()
    //   .attr('class', 'd3-tip')
        
    //    .offset([-10, 0])
    //    .html(function (d) { d['desc2'] });

    var tabulate = function (data, columns) {
        var table = d3.select('#table1')//.append('table')
        var thead = table.append('thead')
        var tbody = table.append('tbody')
   
        thead.append('tr')
        .selectAll('th')
	    .data(columns)
        .enter()
        .append('th')
        .text(function (d) { return d })
        
        var rows = tbody.selectAll('tr')
        .data(data)
        .enter()
        .append('tr')
        //.on("mouseover", function(d, i) {
            

            //(d, i, n) => table_tip.show(d, n[i],
            //console.log('pippo',d,i,n))
            //console.log('this',this);
            //console.log('d_',d[0])
            
            //console.log('i enter',i);
            //'prot_1_'+d['Gene_acc']
            //console.log('d enter',d);

            //table_tip.show(d, document.getElementById("selection_tip_1_"+i))
            //console.log("selection_tip_1_"+i);
            //temp_tip = d3.select("selection_tip_1_"+i);
            //console.log('temp_tip',temp_tip);
            

            //var selector = '#prot_1_'+i;
            //d3.select(selector).attr("r", "100");


        //})
        // make the row red
        //d3.select(this).style("background-color","red");
        // find your path and transition
        //var path = paths[0][i];
        //d3.select(path).transition().duration(100).attr("d", arcOver);
        //console.log('mousein', this.data(function(d) { return d  }) ) }
        //)
        //.on("mouseout",function(d,i){
            //console.log('i exit',i);
            //console.log('d exit',d);

        //})
            //d3.select(this).style("background-color","transparent");
            //var path = paths[0][i];
            //d3.select(path).transition().duration(100).attr("d", arc);
        
        //});
        
        var cells = rows.selectAll('td')
        .data(function(row) {
            return columns.map(function (column) {
                return { column: column, value: row[column] }
            })
        })
        .enter()
        .append('td')
        .text(function (d) { return d.value })
        
        return table;
    }

    var volcanoPlot_1 = volcanoPlot("1")
        .xAxisLabel('Exp Rank')
        .yAxisLabel('False Discovery Rate')
        .foldChangeThreshold(50)
        .significanceThreshold(0.5)
        .sampleID("Gene_id")
        .xColumn("srank")
        .yColumn("log_FDR")
        //.yAxisLabelOffset(0.1)
        .height(300)
        .width(300);

    var volcanoPlot_2 = volcanoPlot("2")
        .xAxisLabel('Exp Rank')
        .yAxisLabel('BSF Intensity Rank')
        .foldChangeThreshold(50)
        .significanceThreshold(6000)
        .sampleID("Gene_id")
        .xColumn("srank")
        .yColumn("BSF_rank2")
        //.yAxisLabelOffset(-100)
        .height(300)
        .width(300);
    
    var volcanoPlot_3 = volcanoPlot("3")
        .xAxisLabel('Exp Rank')
        .yAxisLabel('Log10 Intensity')
        .foldChangeThreshold(50)
        .significanceThreshold(8)
        .sampleID("Gene_id")
        .xColumn("srank")
        .yColumn("Log_Intensity")
        //.AxisLabelOffset(-100)
        //.yAxisLabelOffset(-200)
        .height(300)
        .width(300);    

    d3.csv(file, parser, function(error, data){


        

        if (error) console.log(error);

        var plot_1 = d3.select('#chart1');
        plot_1.data([data]).call(volcanoPlot_1); 
        
        var plot_2 = d3.select('#chart2');
        plot_2.data([data]).call(volcanoPlot_2);

        var plot_3 = d3.select('#chart3');
        plot_3.data([data]).call(volcanoPlot_3);


        var columns = ['Gene_id', 'srank', 'log_FDR', 'BSF_rank2', 'desc2', 'Gene_acc']
        tabulate(data, columns)

        
        var table = $('#table1').DataTable({
        
        dom: "Bfrtip",
        pageLength: 10,

        filter: true,
        columns: [

            { name: "Gene_id", title: 'Ids'},
            { data: "srank", title: 'Rank', 
            render: $.fn.dataTable.render.number( '', '.', 2) },
            { data: "log_FDR" , title: 'FDR', 
            render: $.fn.dataTable.render.number( '', '.', 2)},
            { data: "BSF_rank2" , title: 'Intensity', 
            render: $.fn.dataTable.render.number( '', '.', 1)},
            { data: "desc2" , title: 'Description'},
            { data: "Gene_acc", title: 'Gene Selector', "visible": false}
        ],});
        
        

        $('#table1 tbody').on('mouseover', 'tr', function () {
            //console.log('click');
            var data = table.row( this ).data();
            //alert( 'You clicked on '+data[0]+'\'s row' );
            //console.log(data);
            var gene_acc = data['Gene_acc']
            var selector = '#prot_1_'+gene_acc;
            d3.select(selector).attr("r", "10");
            //d3.select(selector).html('pippo')
            var selector = '#prot_2_'+gene_acc;
            d3.select(selector).attr("r", "10");
            var selector = '#prot_3_'+gene_acc;
            d3.select(selector).attr("r", "10");

            //selector = 'selection_tip_1_'+gene_acc
            //console.log('d3.select(selector)',d3.select(selector))
            //$(selector).attr("visibility", "visible");
            //$(selector).append("div").html('PIPPO');
            //.attr("style", "width:90%; background-color:blue; height: 150px");; 
            
            //$(selector).tooltip( 'visible','true');
            //d3.select(selector).select(function() {console.log('this',d3.select(this).html('pippo'));});   
            //d3.select(selector).select(function() {return d3.select(this).html('pippo')})
            //$( selector ).html( "All new content");

        } );
        //var tooltip = d3.selectAll('tr')
                //.append("div")
                //.attr('class', 'tooltip');

        
        $('#table1 tbody').on('mouseout', 'tr', function () {
            //console.log('click');
            var data = table.row( this ).data();
            //alert( 'You clicked on '+data[0]+'\'s row' );
            //console.log(data);
            var gene_acc = data['Gene_acc']
            var selector = '#prot_1_'+gene_acc;
            d3.select(selector).attr("r", "3");
            var selector = '#prot_2_'+gene_acc;
            d3.select(selector).attr("r", "3");
            var selector = '#prot_3_'+gene_acc;
            d3.select(selector).attr("r", "3");

        } );



        //console.log('tabe',d3.selectAll('#table1 tbody tr').enter().on('mouseenter', console.log('pippo')))
        //.on('mouseenter', console.log('pippo'))


        
    });


    var editor;
    
    $(document).ready(function() {
        

    
    } );

    //d3.select(selector).attr("r", "10")




    // row parser to convert key values into numbers if possible
    function parser(d) {
        for (var key in d) {
            if (d.hasOwnProperty(key)) {
                d[key] = numberParser(d[key]);
            }
        }
        return d;
    }

    // function to turn string into number if possible
    function numberParser(value){
        return (+value) ? +value : value;
    }

	


</script>

</body>
</html>